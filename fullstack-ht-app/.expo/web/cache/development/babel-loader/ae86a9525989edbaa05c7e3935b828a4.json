{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/home/hejoel/fullstack/fullstack-ht/fullstack-ht/fullstack-ht-app/src/components/Messenger.jsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useContext, useRef, useEffect, useCallback } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport { Button, IconButton, TextInput } from 'react-native-paper';\nimport * as firebase from 'firebase';\nimport { sendChatMessage } from \"../firebase/chat\";\nimport { GiftedChat } from 'react-native-gifted-chat';\nimport { useParams } from 'react-router-native';\nimport Text from \"./Text\";\nvar styles = StyleSheet.create({\n  container: {\n    zIndex: 1,\n    padding: 100,\n    height: '100%',\n    width: '100%',\n    position: 'absolute',\n    flexDirection: 'column'\n  },\n  messengerContainer: {},\n  messageContainerSend: {},\n  messageContainerReceived: {},\n  sendMessageContainer: {\n    flexDirection: 'row'\n  }\n});\n\nvar Messenger = function Messenger() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      messages = _useState2[0],\n      setMessages = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      text = _useState4[0],\n      setText = _useState4[1];\n\n  var currentUser = firebase.auth().currentUser;\n\n  var _useParams = useParams(),\n      id = _useParams.id;\n\n  var chatID = function chatID() {\n    var chatterID = currentUser.uid;\n    var chateeID = id;\n    var chatIDpre = [];\n    chatIDpre.push(chatterID);\n    chatIDpre.push(chateeID);\n    chatIDpre.sort();\n    return chatIDpre.join('_');\n  };\n\n  useEffect(function () {\n    var messagesListener = firebase.firestore().collection('THREADS').doc(thread._id).collection('MESSAGES').orderBy('createdAt', 'desc').onSnapshot(function (querySnapshot) {\n      var messages = querySnapshot.docs.map(function (doc) {\n        var firebaseData = doc.data();\n\n        var data = _objectSpread({\n          _id: doc.id,\n          text: '',\n          createdAt: new Date().getTime()\n        }, firebaseData);\n\n        if (!firebaseData.system) {\n          data.user = _objectSpread(_objectSpread({}, firebaseData.user), {}, {\n            name: firebaseData.user.email\n          });\n        }\n\n        return data;\n      });\n      setMessages(messages);\n    });\n    return function () {\n      return messagesListener();\n    };\n  }, []);\n  var db = firebase.firestore();\n  var getMessages = db.collection('messages').doc(chatID()).collection('chats').orderBy('createdAt', 'desc').onSnapshot(function (doc) {\n    setMessages(doc.docs);\n  });\n  getMessages();\n  useEffect(function () {\n    setMessages([{\n      _id: 1,\n      text: 'Hello developer',\n      createdAt: new Date(),\n      user: {\n        _id: 2,\n        name: 'React Native',\n        avatar: 'https://placeimg.com/140/140/any'\n      }\n    }]);\n  }, []);\n\n  var _onSend = useCallback(function () {\n    var messages = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    setMessages(function (previousMessages) {\n      return GiftedChat.append(previousMessages, messages);\n    });\n  }, []);\n\n  return React.createElement(View, {\n    style: styles.container\n  }, React.createElement(GiftedChat, {\n    messages: messages,\n    onSend: function onSend(messages) {\n      return _onSend(messages);\n    },\n    user: {\n      _id: currentUser.uid\n    }\n  }));\n};\n\nexport default Messenger;","map":{"version":3,"sources":["/home/hejoel/fullstack/fullstack-ht/fullstack-ht/fullstack-ht-app/src/components/Messenger.jsx"],"names":["React","useState","useContext","useRef","useEffect","useCallback","Button","IconButton","TextInput","firebase","sendChatMessage","GiftedChat","useParams","Text","styles","StyleSheet","create","container","zIndex","padding","height","width","position","flexDirection","messengerContainer","messageContainerSend","messageContainerReceived","sendMessageContainer","Messenger","messages","setMessages","text","setText","currentUser","auth","id","chatID","chatterID","uid","chateeID","chatIDpre","push","sort","join","messagesListener","firestore","collection","doc","thread","_id","orderBy","onSnapshot","querySnapshot","docs","map","firebaseData","data","createdAt","Date","getTime","system","user","name","email","db","getMessages","avatar","onSend","previousMessages","append"],"mappings":"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","sourcesContent":["import React, { useState, useContext, useRef, useEffect, useCallback } from 'react';\nimport {View, StyleSheet} from 'react-native';\nimport {Button, IconButton, TextInput} from 'react-native-paper';\nimport * as firebase from 'firebase';\nimport { sendChatMessage } from '../firebase/chat';\nimport { GiftedChat } from 'react-native-gifted-chat';\nimport { useParams } from 'react-router-native';\nimport Text from './Text';\n\n\nconst styles = StyleSheet.create({\n    container: {\n        zIndex: 1,\n        padding: 100,\n        height: '100%',\n        width: '100%',\n        position: 'absolute',\n        flexDirection: 'column'\n    },\n    messengerContainer: {\n\n    },\n    messageContainerSend: {\n        // backgroundcolor: 'red'\n        \n    },\n    messageContainerReceived: {\n        // backgroundcolor: 'yellow'\n    },\n    sendMessageContainer: {\n        flexDirection: 'row'\n    }\n});\n\n\n\nconst Messenger = () => {\n\n    const [messages, setMessages] = useState([]);\n\n    const [text, setText] = useState('');\n    const currentUser = firebase.auth().currentUser;\n    const { id } = useParams();\n\n\n    const chatID = () => {\n        const chatterID = currentUser.uid;\n        const chateeID = id;\n        const chatIDpre = [];\n        chatIDpre.push(chatterID);\n        chatIDpre.push(chateeID);\n        chatIDpre.sort();\n        return chatIDpre.join('_');\n      };\n\n    useEffect(() => {\n        const messagesListener = firebase.firestore()\n            .collection('THREADS')\n            .doc(thread._id)\n            .collection('MESSAGES')\n            .orderBy('createdAt', 'desc')\n            .onSnapshot(querySnapshot => {\n                const messages = querySnapshot.docs.map(doc => {\n                    const firebaseData = doc.data();\n\n                    const data = {\n                        _id: doc.id,\n                        text: '',\n                        createdAt: new Date().getTime(),\n                        ...firebaseData\n                    };\n\n                    if (!firebaseData.system) {\n                        data.user = {\n                            ...firebaseData.user,\n                            name: firebaseData.user.email\n                        };\n                    }\n\n                    return data;\n                });\n\n                setMessages(messages);\n            });\n\n        return () => messagesListener();\n    }, []);\n    \n    const db = firebase.firestore();\n      let getMessages = \n      db.collection('messages')\n        .doc(chatID())\n        .collection('chats')\n        .orderBy('createdAt', 'desc')\n        \n        .onSnapshot((doc) => {\n            setMessages(doc.docs);        \n        });\n\n        getMessages();\n        \n    useEffect(() => {\n        setMessages([\n            {\n                _id: 1,\n                text: 'Hello developer',\n                createdAt: new Date(),\n                user: {\n                    _id: 2,\n                    name: 'React Native',\n                    avatar: 'https://placeimg.com/140/140/any',\n                },\n            },\n        ]);\n    }, []);\n\n    // talleta messaget firestoreen ja get them from there\n\n    // const onSend = useCallback((messages = []) => {\n    //     setMessages(previousMessages => GiftedChat.append(previousMessages, messages));\n    // }, []);\n\n    const onSend = useCallback((messages = []) => {\n        setMessages(previousMessages => GiftedChat.append(previousMessages, messages));\n    }, []);\n\n\n    return(\n        <View style={styles.container}>\n\n            <GiftedChat\n                messages={messages}\n                onSend={messages => onSend(messages)}\n                // onSend={handleSend}\n                user={{\n                    _id: currentUser.uid\n                }}\n            />\n\n            {/* <View style={styles.sendMessageContainer}>\n                <TextInput\n                    label=\"\"\n                    value={text}\n                    onChangeText={text => setText(text)}\n                />\n                <IconButton icon=\"send\" size={25} onPress={()=>{sendChatMessage(chatID(),text);}} />\n            </View> */}\n                    \n        </View>\n    );\n};\n\nexport default Messenger;"]},"metadata":{},"sourceType":"module"}